# RTI SHP TraceViewer Transport Protocol (TCPTunnel / Port 2113)

## Purpose

This document defines the **on‑wire transport and framing behavior** used by RTI Smart Home Processors (SHP) to deliver TraceViewer diagnostics data.

It is written for **AI ingestion (Codex)** and focuses strictly on:
- how the communication works
- how the data is structured
- how the data is retrieved

It intentionally avoids interpretation, automation logic, or UI concerns.

---

## Key Clarification (Critical)

**TraceViewer does NOT capture network traffic.**

TraceViewer receives **internal SHP log output** that is serialized and transmitted over a dedicated TCP channel. Any cloud driver activity (e.g. HTTPS calls to manufacturers) appears in TraceViewer **only if the driver emits log messages**.

TraceViewer never mirrors raw cloud traffic. It mirrors **what the SHP logs about that traffic**.

---

## Network Topology

- **Server:** RTI Smart Home Processor (SHP)
- **Client:** RTI TraceViewer application
- **Transport:** TCP
- **Port:** `2113`
- **Direction of usable data:** **SHP → Client only**

Client → SHP packets contain ACKs, keepalives, and handshake noise and can be ignored for extraction.

---

## Capture Filter (Wireshark)

Use this display filter:

```
tcp.port == 2113 && tcp.len > 0
```

### Why this works
- `tcp.port == 2113` isolates the TraceViewer / TCPTunnel stream
- `tcp.len > 0` removes ACK‑only, SYN, keepalive, and empty frames

Do **not** filter by WebSocket, JSON, HTTP, or ephemeral ports. Those layers do not apply to TraceViewer.

---

## Transport Characteristics

- Single persistent TCP stream
- Arbitrary TCP segmentation
- Records may span multiple packets
- Multiple records may appear in a single packet
- Parsing **must be stream‑based**, not packet‑based

---

## Data Classes Observed on Port 2113

### 1. Framed TraceViewer Records (Desired Data)

These correspond **exactly** to what TraceViewer displays.

**Properties:**
- Encoding: **UTF‑16LE**
- Direction: **Server → Client only**
- Explicit byte framing
- One frame = one TraceViewer log line

#### Record Start Marker

```
01 00
```

#### Record End Marker

```
03 00
```

Optional but common:

```
0A 00   (UTF‑16 newline)
```

#### Example

Hex (excerpt):

```
01 00
54 00 57 00 78 00 50 00 6F 00 72 00 74 00
20 00 2F 00 49 00 6E 00 66 00 6F 00 72 00
6D 00 61 00 74 00 3A 00 ...
03 00
```

Decoded UTF‑16LE:

```
TWxPort /Informat:01/17/2026 09:09:25.8 ...
```

This text matches TraceViewer UI output byte‑for‑byte.

---

### 2. Unframed Keepalive Noise (Ignore)

These bytes are interleaved and must be discarded.

Example:

```
68 65 6C 6C 6F
```

Decoded:

```
hello
```

**Properties:**
- ASCII
- No framing
- No semantic value
- Appears repeatedly

---

## Directionality Rule (Invariant)

TraceViewer records appear **only** in packets where:

- `src.port == 2113`
- `src.ip == SHP`

Client → server packets contain no framed records.

---

## Extraction Rules (Authoritative)

An extractor must follow these rules exactly:

1. Read bytes sequentially from the TCP stream
2. Ignore all bytes until `01 00` is encountered
3. Begin buffering at `01 00`
4. Continue buffering until `03 00` is encountered
5. Extract buffered bytes (excluding framing markers)
6. Decode extracted bytes as **UTF‑16LE**
7. Emit exactly one TraceViewer log line
8. Resume scanning for the next `01 00`

All bytes outside framed regions are discarded.

---

## Cloud Driver Activity

- Cloud drivers communicate with manufacturers over normal Internet protocols (e.g. HTTPS)
- TraceViewer does **not** see those sockets
- TraceViewer only receives **internal SHP log output** generated by drivers
- If a cloud driver logs activity, it will appear as framed records on port 2113
- If a cloud driver does not log activity, nothing appears

Transport behavior does **not** change based on driver type.

---

## Relationship to Web Diagnostics

- Web diagnostics use filtered, structured feeds (JSON / WebSocket)
- TraceViewer uses raw TCPTunnel output
- TraceViewer exposes **more data** than the web UI
- This document applies **only** to TraceViewer transport

---

## Explicit Non‑Goals

This document does **not** define:
- Meaning of log fields
- Command semantics
- Event correlation
- UI rendering
- Storage schema
- Alerting logic

Those belong in separate documents.

---

## Proven Facts Summary

- Port 2113 is a mixed binary/text stream
- TraceViewer records are explicitly framed
- Encoding is UTF‑16LE
- Direction is SHP → client
- Framing markers are invariant
- Keepalive noise must be ignored
- Cloud activity appears only as internal log text

No assumptions beyond these facts are required.

---

## End of Document

